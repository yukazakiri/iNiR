# Fish Shell Dynamic Theming for ii Wallpaper System

This configuration enables fish shell to automatically synchronize its syntax highlighting colors with the kitty terminal theme generated by the ii wallpaper theming system.

## How It Works

1. **Kitty Theme Generation**: The ii wallpaper system generates `~/.config/kitty/current-theme.conf` with colors extracted from the current wallpaper
2. **Fish Color Loading**: The `ii-theme.fish` configuration reads these colors and applies them to fish's syntax highlighting
3. **Dynamic Updates**: When the wallpaper changes, fish colors automatically update to match

## Files

- `conf.d/ii-theme.fish` - Main theming configuration loaded on shell startup
- `config.fish` - Main fish configuration that sources the theme
- `fish_variables` - Universal variables (colors managed dynamically by ii-theme.fish)

## Usage

### Manual Reload

To reload fish colors manually (e.g., after changing wallpaper):

```fish
ii_reload_fish_theme
```

Or the shorter alias:

```fish
reload_fish_theme
```

### Automatic Reload

Fish automatically checks for theme updates on every prompt. When the wallpaper changes and `~/.cache/fish_theme_reload` is updated, fish will refresh its colors.

### Integration with Wallpaper Scripts

Add this to your wallpaper change script to notify all fish shells:

```fish
# Update the reload timestamp
echo (date +%s) > ~/.cache/fish_theme_reload

# Or use the provided script
fish ~/inir/scripts/reload-fish-theme.fish broadcast
```

## Color Mapping

Fish syntax highlighting colors are mapped from kitty theme colors:

| Fish Color | Kitty Color | Usage |
|------------|-------------|-------|
| `fish_color_normal` | `foreground` | Default text |
| `fish_color_command` | `color4` (blue) | Commands |
| `fish_color_param` | `color6` (cyan) | Parameters |
| `fish_color_keyword` | `color5` (magenta) | Keywords |
| `fish_color_quote` | `color2` (green) | Quoted strings |
| `fish_color_redirection` | `color3` (yellow) | Redirections |
| `fish_color_error` | `color1` (red) | Errors |
| `fish_color_comment` | `brblack` | Comments |

## Troubleshooting

### Colors not updating

1. Check that `~/.config/kitty/current-theme.conf` exists and has colors
2. Run `ii_reload_fish_theme` manually to test
3. Check fish version: `fish --version` (needs 3.0+)

### Syntax highlighting looks wrong

The theme uses hex color codes from the kitty theme. If your terminal doesn't support true color, fall back to named colors which will use the terminal's 16-color palette set by kitty.

## Compatibility

- Fish 3.0+
- Kitty terminal with ii wallpaper theming
- Works with Pure prompt theme

## Notes

- Colors are stored as universal variables (`set -U`) so they persist across sessions
- The `fish_variables` file should not have hardcoded colors - they are managed by `ii-theme.fish`
- If you customize colors manually, they will be overwritten when the theme reloads
